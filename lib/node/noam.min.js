!function(a){"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=a),"undefined"!=typeof exports&&"function"!=typeof exports&&(exports.noam=a),"function"==typeof define&&define.amd&&define("noam",[],function(){return a}),"undefined"!=typeof window&&(window.noam=a)}(function(){var a={};return a.util={},a.util.areEquivalent=function(b,c){if(b===c)return!0;if(b instanceof Date&&c instanceof Date)return b.getTime()===c.getTime();if(b instanceof RegExp&&c instanceof RegExp)return b.source===c.source&&b.global===c.global&&b.multiline===c.multiline&&b.lastIndex===c.lastIndex&&b.ignoreCase===c.ignoreCase;if(!(b instanceof Object&&c instanceof Object))return!1;if("undefined"==typeof b||"undefined"==typeof c)return!1;if(b.constructor!==c.constructor)return!1;for(var d in b){if(!(d in c))return!1;if(b[d]!==c[d]){if("object"!=typeof b[d])return!1;if(!a.util.areEquivalent(b[d],c[d]))return!1}}for(d in c)if(!(d in b))return!1;return!0},a.util.contains=function(b,c,d){d=d?d:0;for(var e=d;e<b.length;e++)if(a.util.areEquivalent(b[e],c))return!0;return!1},a.util.index=function(b,c,d){for(var e=d||0;e<b.length;){if(a.util.areEquivalent(b[e],c))return e;e++}return-1},a.util.containsAll=function(b,c){for(var d=0;d<c.length;d++)if(!a.util.contains(b,c[d]))return!1;return!0},a.util.containsAny=function(b,c){for(var d=0;d<c.length;d++)if(a.util.contains(b,c[d]))return!0;return!1},a.util.areEqualSets=function(b,c){if(b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(!a.util.contains(c,b[d]))return!1;return!0},a.util.containsSet=function(b,c){for(var d=0;d<b.length;d++)if(a.util.areEqualSets(b[d],c))return!0;return!1},a.util.setUnion=function(b,c){var d,e=[];for(d=0;d<b.length;d++)a.util.contains(e,b[d])||e.push(b[d]);for(d=0;d<c.length;d++)a.util.contains(e,c[d])||e.push(c[d]);return e},a.util.setIntersection=function(b,c){var d,e=[];for(d=0;d<b.length;d++)a.util.contains(c,b[d])&&e.push(b[d]);return e},a.util.clone=function(a){return JSON.parse(JSON.stringify(a))},a.util.makeCounter=function(){function a(){return this.value++}function b(b){return{value:b,getAndAdvance:a}}return b}(),a.util.randint=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},a.util.HashTable=require("structure.js").HashTable,a.fsm={},a.fsm.epsilonSymbol="$",a.fsm.dfaType="DFA",a.fsm.nfaType="NFA",a.fsm.enfaType="eNFA",a.fsm.makeNew=function(){return{states:[],alphabet:[],acceptingStates:[],initialState:void 0,transitions:[]}},a.fsm._addStateOrSymbol=function(b,c,d,e){if(void 0===c)throw new Error(d);if(a.util.contains(b,c))throw new Error(e);return b.push(c),c},a.fsm.addState=function(b,c){return a.fsm._addStateOrSymbol(b.states,c,"No state object specified","State already exists")},a.fsm.addSymbol=function(b,c){if(a.util.areEquivalent(c,a.fsm.epsilonSymbol))throw new Error("Can't add the epsilon symbol to the alphabet");return a.fsm._addStateOrSymbol(b.alphabet,c,"No symbol object specified","Symbol already exists")},a.fsm.addAcceptingState=function(b,c){if(!a.util.contains(b.states,c))throw new Error("The specified object is not a state of the FSM");a.fsm._addStateOrSymbol(b.acceptingStates,c,"","The specified state is already accepting")},a.fsm.setInitialState=function(b,c){if(!a.util.contains(b.states,c))throw new Error("The specified object is not a state of the FSM");b.initialState=c},a.fsm._addTransition=function(b,c,d,e){if(!Array.isArray(d))throw new Error("The toStates argument must be an array");if(!a.util.contains(b.states,c)||!a.util.containsAll(b.states,d))throw new Error("One of the specified objects is not a state of the FSM");var f,g=!1;for(f=0;f<b.transitions.length;f++)if(a.util.areEquivalent(c,b.transitions[f].fromState)&&a.util.areEquivalent(e,b.transitions[f].symbol)){b.transitions[f].toStates=a.util.setUnion(b.transitions[f].toStates,d),g=!0;break}g||b.transitions.push({fromState:c,toStates:d,symbol:e})},a.fsm.addTransition=function(b,c,d,e){if(!a.util.contains(b.alphabet,e))throw new Error("The specified object is not an alphabet symbol of the FSM");a.fsm._addTransition(b,c,d,e)},a.fsm.addEpsilonTransition=function(b,c,d){a.fsm._addTransition(b,c,d,a.fsm.epsilonSymbol)},a.fsm.validate=function(b){var c,d,e;if(!("undefined"!=typeof b&&Array.isArray(b.states)&&Array.isArray(b.alphabet)&&Array.isArray(b.acceptingStates)&&"undefined"!=typeof b.initialState&&null!==b.initialState&&Array.isArray(b.transitions)))throw new Error("FSM must be defined and have states, alphabet, acceptingStates, initialState and transitions array properties!");if(b.states.length<1)throw new Error("Set of states must not be empty.");for(c=0;c<b.states.length;c++)if(a.util.contains(b.states,b.states[c],c+1))throw new Error("Equivalent states");if(b.alphabet.length<1)throw new Error("Alphabet must not be empty.");for(c=0;c<b.alphabet.length;c++)if(a.util.contains(b.alphabet,b.alphabet[c],c+1))throw new Error("Equivalent alphabet symbols");if(a.util.contains(b.alphabet,a.fsm.epsilonSymbol))throw new Error("FSM alphabet must not contain the epsilon symbol");for(c=0;c<b.alphabet.length;c++)if(a.util.contains(b.states,b.alphabet[c]))throw new Error("States and alphabet symbols must not overlap");for(c=0;c<b.acceptingStates.length;c++){if(a.util.contains(b.acceptingStates,b.acceptingStates[c],c+1))throw new Error("Equivalent acceptingStates");if(!a.util.contains(b.states,b.acceptingStates[c]))throw new Error("Each accepting state must be in states")}if(!a.util.contains(b.states,b.initialState))throw new Error("Initial state must be in states");for(c=0;c<b.transitions.length;c++){var f=b.transitions[c];if("undefined"==typeof f.fromState||"undefined"==typeof f.toStates||"undefined"==typeof f.symbol)throw new Error("Transitions must have fromState, toState and symbol");if(!a.util.contains(b.states,f.fromState))throw new Error("Transition fromState must be in states.");if(!a.util.contains(b.alphabet,f.symbol)&&f.symbol!==a.fsm.epsilonSymbol)throw new Error("Transition symbol must be in alphabet.");for(e=0;e<f.toStates.length;e++){if(!a.util.contains(b.states,f.toStates[e]))throw new Error("Transition toStates must be in states.");if(a.util.contains(f.toStates,f.toStates[e],e+1))throw new Error("Transition toStates must not contain duplicates.")}}for(c=0;c<b.transitions.length;c++)for(d=c+1;d<b.transitions.length;d++)if(b.transitions[c].fromState===b.transitions[d].fromState&&b.transitions[c].symbol===b.transitions[d].symbol)throw new Error("Transitions for the same fromState and symbol must be defined in a single trainsition.");return!0},a.fsm.isAcceptingState=function(b,c){return a.util.contains(b.acceptingStates,c)},a.fsm.determineType=function(b){for(var c=a.fsm.dfaType,d=0;d<b.transitions.length;d++){var e=b.transitions[d];if(e.symbol===a.fsm.epsilonSymbol){c=a.fsm.enfaType;break}(0===e.toStates.length||e.toStates.length>1)&&(c=a.fsm.nfaType)}return c===a.fsm.dfaType&&b.transitions.length<b.states.length*b.alphabet.length&&(c=a.fsm.nfaType),c},a.fsm.computeEpsilonClosure=function(b,c){if(!a.util.containsAll(b.states,c))throw new Error("FSM must contain all states for which epsilon closure is being computed");for(var d=c,e=[];0!==d.length;){var f=d.pop();e.push(f);for(var g=0;g<b.transitions.length;g++){var h=b.transitions[g];if(h.symbol===a.fsm.epsilonSymbol&&a.util.areEquivalent(h.fromState,f))for(var i=0;i<h.toStates.length;i++)a.util.contains(e,h.toStates[i])||a.util.contains(d,h.toStates[i])||d.push(h.toStates[i])}}return e},a.fsm.makeSimpleTransition=function(b,c,d){if(!a.util.containsAll(b.states,c))throw new Error("FSM must contain all states for which the transition is being computed");if(!a.util.contains(b.alphabet,d))throw new Error("FSM must contain input symbol for which the transition is being computed");for(var e=[],f=0;f<b.transitions.length;f++){var g=b.transitions[f];if(a.util.areEquivalent(b.transitions[f].symbol,d)&&a.util.contains(c,g.fromState))for(var h=0;h<g.toStates.length;h++)a.util.contains(e,g.toStates[h])||e.push(g.toStates[h])}return e},a.fsm.makeTransition=function(b,c,d){if(!a.util.containsAll(b.states,c))throw new Error("FSM must contain all states for which the transition is being computed");if(!a.util.contains(b.alphabet,d))throw new Error("FSM must contain input symbol for which the transition is being computed");var e=a.util.clone(c);return e=a.fsm.computeEpsilonClosure(b,e),e=a.fsm.makeSimpleTransition(b,e,d),e=a.fsm.computeEpsilonClosure(b,e)},a.fsm.readString=function(b,c){if(!a.util.containsAll(b.alphabet,c))throw new Error("FSM must contain all symbols for which the transition is being computed");for(var d=a.fsm.computeEpsilonClosure(b,[b.initialState]),e=0;e<c.length;e++)d=a.fsm.makeTransition(b,d,c[e]);return d},a.fsm.transitionTrail=function(b,c,d){if(!a.util.containsAll(b.alphabet,d))throw new Error("FSM must contain all symbols for which the transition is being computed");for(var e=[c],f=[a.util.clone(e)],g=0;g<d.length;g++)e=a.fsm.makeTransition(b,e,d[g]),f.push(a.util.clone(e));return f},a.fsm.isStringInLanguage=function(b,c){var d=a.fsm.readString(b,c);return a.util.containsAny(b.acceptingStates,d)},a.fsm.printTable=function(b){var c=require("cli-table"),d=[""].concat(b.alphabet);a.fsm.determineType(b)===a.fsm.enfaType&&d.push(a.fsm.epsilonSymbol),d.push("");var e,f,g=new c({head:d,chars:{top:"-","top-mid":"+","top-left":"+","top-right":"+",bottom:"-","bottom-mid":"+","bottom-left":"+","bottom-right":"+",left:"|","left-mid":"+",mid:"-","mid-mid":"+",right:"|","right-mid":"+"},truncate:"~"}),h=[];for(e=0;e<b.states.length;e++){for(h.push(new Array(d.length)),f=0;f<d.length;f++)h[e][f]="";h[e][0]=b.states[e].toString(),h[e][d.length-1]=a.util.contains(b.acceptingStates,b.states[e])?"1":"0",g.push(h[e])}for(e=0;e<b.transitions.length;e++){var i=b.transitions[e],j=null,k=null;for(f=0;f<b.states.length;f++)if(a.util.areEquivalent(b.states[f],i.fromState)){k=f;break}if(i.symbol===a.fsm.epsilonSymbol)j=d.length-2;else for(f=0;f<b.alphabet.length;f++)if(a.util.areEquivalent(b.alphabet[f],i.symbol)){j=f+1;break}"undefined"==typeof h[k][j].text&&(h[k][j]={text:[]}),h[k][j].text.push(i.toStates)}return g.toString()},a.fsm.serializeFsmToString=function(a){var b=[];b.push("#states");for(var c=0;c<a.states.length;c++)b.push(a.states[c].toString());b.push("#initial"),b.push(a.initialState.toString()),b.push("#accepting");for(var c=0;c<a.acceptingStates.length;c++)b.push(a.acceptingStates[c].toString());b.push("#alphabet");for(var c=0;c<a.alphabet.length;c++)b.push(a.alphabet[c].toString());b.push("#transitions");for(var c=0;c<a.transitions.length;c++)b.push(a.transitions[c].fromState.toString()+":"+a.transitions[c].symbol.toString()+">"+a.transitions[c].toStates.join(","));return b.join("\n")},a.fsm.parseFsmFromString=function(b){for(var c,d=b.split(/\r?\n/),e=[],f=[],g=[],h=[],i=null,j={states:0,initial:0,accepting:0,alphabet:0,transitions:0},k=0;k<d.length;k++){var l=d[k].replace(/\s/g,"");if(0!==l.length)if("#"===l[0]){if(i=l.substr(1),"undefined"==typeof j[i])throw new Error("Line "+(k+1).toString()+": invalid section name "+i+". Must be one of: states, initial,                            accepting, alphabet, transitions.");if(j[i]+=1,j[i]>1)throw new Error("Line "+(k+1).toString()+": duplicate section name "+i+".")}else{if(null==i)throw new Error("Line "+(k+1).toString()+": no #section declared.                           Add one section: states, initial, accepting,                           alphabet, transitions.");if("states"===i){var m=l.split(";");e=e.concat(m)}else if("initial"==i)c=l;else if("accepting"==i){var n=l.split(";");f=f.concat(n)}else if("alphabet"==i){var o=l.split(";");g=g.concat(o)}else if("transitions"==i){for(var p=l.split(":"),q=p[0].split(","),r=p[1].split(";"),s=0;s<r.length;s++)var t=r[s].split(">"),u=t[0].split(","),v=t[1].split(",");h.push([q,u,v])}}}for(var w in j)if(1!==j[w])throw new Error("Specification missing #"+j[w]+" section.");for(var x=a.fsm.makeNew(),k=e.length-1;k>=0;k--)a.fsm.addState(x,e[k]);for(var k=g.length-1;k>=0;k--)a.fsm.addSymbol(x,g[k]);for(var k=0;k<f.length;k++)a.fsm.addAcceptingState(x,f[k]);a.fsm.setInitialState(x,c);for(var k=0;k<h.length;k++)for(var y=h[k],s=0;s<y[0].length;s++)for(var w=0;w<y[1].length;w++)y[1][w]===a.fsm.epsilonSymbol?a.fsm.addEpsilonTransition(x,y[0][s],y[2]):a.fsm.addTransition(x,y[0][s],y[2],y[1][w]);return a.fsm.validate(x),x},a.fsm.printHtmlTable=function(b){var c=[""].concat(b.alphabet);a.fsm.determineType(b)===a.fsm.enfaType&&c.push(a.fsm.epsilonSymbol),c.push("");var d,e,f=[];for(d=0;d<b.states.length;d++){for(f.push(new Array(c.length)),e=0;e<c.length;e++)f[d][e]={text:[]};f[d][0]={text:b.states[d].toString()},f[d][c.length-1]=a.util.contains(b.acceptingStates,b.states[d])?{text:["1"]}:{text:["0"]}}for(d=0;d<b.transitions.length;d++){var g=b.transitions[d],h=null,i=null;for(e=0;e<b.states.length;e++)if(a.util.areEquivalent(b.states[e],g.fromState)){i=e;break}if(g.symbol===a.fsm.epsilonSymbol)h=c.length-2;else for(e=0;e<b.alphabet.length;e++)if(a.util.areEquivalent(b.alphabet[e],g.symbol)){h=e+1;break}"undefined"==typeof f[i][h].text&&(f[i][h]={text:[]}),f[i][h].text.push(g.toStates)}var j=[];for(j.push("<table border='1'>"),j.push("  <tr>"),d=0;d<c.length;d++)j.push("    <th>"+c[d].toString()+"</th>");for(j.push("  </tr>"),d=0;d<f.length;d++){for(j.push("  <tr>"),e=0;e<f[d].length;e++)j.push("    <td>"+f[d][e].text+"</td>");j.push("  </tr>")}return j.push("</table>"),j.join("\n")},a.fsm.printDotFormat=function(b){var c,d,e,f,g=["digraph finite_state_machine {","  rankdir=LR;"],h=["  node [shape = doublecircle];"];for(c=0;c<b.acceptingStates.length;c++)h.push(b.acceptingStates[c].toString());h.push(";"),h.length>2&&g.push(h.join(" ")),g.push("  node [shape = circle];"),g.push("  secret_node [style=invis, shape=point];");var i=["  secret_node ->"];i.push(b.initialState.toString()),i.push("[style=bold];"),g.push(i.join(" "));var j=[];for(c=0;c<b.transitions.length;c++)for(d=0;d<b.transitions[c].toStates.length;d++){var k=null;for(e=0;e<j.length;e++)a.util.areEquivalent(j[e].fromState,b.transitions[c].fromState)&&a.util.areEquivalent(j[e].toStates,[b.transitions[c].toStates[d]])&&(k=j[e]);if(null===k){var l=a.util.clone(b.transitions[c]);l.toStates=[l.toStates[d]],l.symbol=[l.symbol],j.push(l)}else k.symbol.push(b.transitions[c].symbol)}for(c=0;c<j.length;c++)a.util.areEquivalent(j[c].toStates[0],b.initialState)?(f=[" "],f.push(j[c].toStates[0].toString()),f.push("->"),f.push(j[c].fromState.toString()),f.push("["),f.push("label ="),f.push('"'+j[c].symbol.toString()+'"'),f.push(" dir = back];"),g.push(f.join(" "))):(f=[" "],f.push(j[c].fromState.toString()),f.push("->"),f.push(j[c].toStates[0].toString()),f.push("["),f.push("label ="),f.push('"'+j[c].symbol.toString()+'"'),f.push(" ];"),g.push(f.join(" ")));return g.push("}"),g.join("\n").replace(/\$/g,"$")},a.fsm.getReachableStates=function(b,c,d){for(var e,f,g=[c],h=d?[c]:[];0!==g.length;){var i=g.pop();for(e=0;e<b.transitions.length;e++){var j=b.transitions[e];if(a.util.areEquivalent(i,j.fromState))for(f=0;f<j.toStates.length;f++)a.util.contains(h,j.toStates[f])||(h.push(j.toStates[f]),a.util.contains(g,j.toStates[f])||g.push(j.toStates[f]))}}return h},a.fsm.removeUnreachableStates=function(b){var c,d=a.fsm.getReachableStates(b,b.initialState,!0),e=a.util.clone(b);for(e.states=[],e.acceptingStates=[],e.transitions=[],c=0;c<b.states.length;c++)a.util.contains(d,b.states[c])&&e.states.push(a.util.clone(b.states[c]));for(c=0;c<b.acceptingStates.length;c++)a.util.contains(d,b.acceptingStates[c])&&e.acceptingStates.push(a.util.clone(b.acceptingStates[c]));for(c=0;c<b.transitions.length;c++)a.util.contains(d,b.transitions[c].fromState)&&e.transitions.push(a.util.clone(b.transitions[c]));return e},a.fsm.areEquivalentStates=function(b,c,d,e){function f(b,c,d,e){var f=a.util.contains(b.acceptingStates,c),g=a.util.contains(d.acceptingStates,e);return f&&g||!f&&!g}if(a.fsm.determineType(b)!==a.fsm.dfaType||a.fsm.determineType(d)!==a.fsm.dfaType)throw new Error("FSMs must be DFAs");if(b.alphabet.length!==d.alphabet.length||!a.util.containsAll(b.alphabet,d.alphabet))throw new Error("FSM alphabets must be the same");if(!a.util.contains(b.states,c)||!a.util.contains(d.states,e))throw new Error("FSMs must contain states");for(var g,h=[[c,e]],i=[];0!==h.length;){var j=h.pop();if(!f(b,j[0],d,j[1]))return!1;for(i.push(j),g=0;g<b.alphabet.length;g++){var k=[a.fsm.makeTransition(b,[j[0]],b.alphabet[g])[0],a.fsm.makeTransition(d,[j[1]],b.alphabet[g])[0]];a.util.contains(i,k)||a.util.contains(h,k)||h.push(k)}}return!0},a.fsm.areEquivalentFSMs=function(b,c){return a.fsm.areEquivalentStates(b,b.initialState,c,c.initialState)},a.fsm.removeEquivalentStates=function(b){function c(b){for(var c=0;c<h.length;c++)if(a.util.areEquivalent(h[c][1],b))return!0;return!1}function d(b){for(var c=0;c<h.length;c++)if(a.util.areEquivalent(h[c][1],b))return h[c][0];return b}if(a.fsm.determineType(b)!==a.fsm.dfaType)throw new Error("FSM must be DFA");var e,f,g,h=[];for(e=0;e<b.states.length;e++)for(f=e+1;f<b.states.length;f++)if(a.fsm.areEquivalentStates(b,b.states[e],b,b.states[f])){var i=[b.states[e],b.states[f]];for(g=0;g<h.length;g++)if(a.util.areEquivalent(h[g][1],i[0])){i[0]=h[g][1];break}a.util.contains(h,i)||h.push(i)}var j={states:[],alphabet:a.util.clone(b.alphabet),initialState:[],acceptingStates:[],transitions:[]};for(e=0;e<b.states.length;e++)c(b.states[e])||j.states.push(a.util.clone(b.states[e]));for(e=0;e<b.acceptingStates.length;e++)c(b.acceptingStates[e])||j.acceptingStates.push(a.util.clone(b.acceptingStates[e]));for(j.initialState=a.util.clone(d(b.initialState)),e=0;e<b.transitions.length;e++){var k=a.util.clone(b.transitions[e]);if(!c(k.fromState)){for(f=0;f<k.toStates.length;f++)k.toStates[f]=d(k.toStates[f]);j.transitions.push(k)}}return j},a.fsm.minimize=function(b){var c=a.fsm.determineType(b),d=b;c===a.fsm.nfaType?d=a.fsm.convertNfaToDfa(b):c===a.fsm.enfaType&&(d=a.fsm.convertEnfaToNfa(b),d=a.fsm.convertNfaToDfa(d));var e=a.fsm.removeUnreachableStates(d),f=a.fsm.removeEquivalentStates(e);return f},a.fsm.convertStatesToNumbers=function(b){var c=a.fsm.makeNew(),d={};for(i=0;i<b.states.length;i++)d[b.states[i].toString()]=i;for(c.alphabet=a.util.clone(b.alphabet),i=0;i<b.states.length;i++)a.fsm.addState(c,d[b.states[i].toString()]);for(a.fsm.setInitialState(c,d[b.initialState.toString()]),i=0;i<b.acceptingStates.length;i++)a.fsm.addAcceptingState(c,d[b.acceptingStates[i].toString()]);for(i=0;i<b.transitions.length;i++){var e=[];for(j=0;j<b.transitions[i].toStates.length;j++)e.push(d[b.transitions[i].toStates[j].toString()]);a.fsm.addTransition(c,d[b.transitions[i].fromState.toString()],e,b.transitions[i].symbol)}return c},a.fsm.createRandomFsm=function(b,c,d,e){function f(a,b,c){for(var d=c,e=0;e<c.length-b;e++)d=a+c;return d}var g,h,i,j={};for(j.states=[],g=0,len=c.toString().length;c>g;g++)j.states.push("s"+f("0",len,g.toString()));if(j.alphabet=[],d>26)for(g=0,len=d.toString().length;d>g;g++)j.alphabet.push("a"+f("0",len,g.toString()));else j.alphabet="abcdefghijklmnopqrstuvwxyz".substr(0,d).split("");for(j.initialState=j.states[0],j.acceptingStates=[],g=0;c>g;g++)Math.round(Math.random())&&j.acceptingStates.push(j.states[g]);for(b===a.fsm.enfaType&&j.alphabet.push(a.fsm.epsilonSymbol),j.transitions=[],g=0;c>g;g++)for(h=0;h<j.alphabet.length;h++){var k=1;if(b!==a.fsm.dfaType&&(k=Math.floor(Math.random()*e)),k>0){var l=[];for(i=0;i<j.states.length&&l.length<k;i++){var m=j.states.length-i-(k-l.length)+1;m=0>=m?1:1/m,Math.random()<=m&&l.push(j.states[i])}j.transitions.push({fromState:j.states[g],symbol:j.alphabet[h],toStates:l})}}return b===a.fsm.enfaType&&j.alphabet.pop(),j},a.fsm.convertNfaToDfa=function(b){var c=a.fsm.determineType(b);if(c===a.fsm.enfaType)throw new Error("FSM must be an NFA");if(c===a.fsm.dfaType)return b;var d,e,f,g,h={};for(h.alphabet=a.util.clone(b.alphabet),h.states=[],h.acceptingStates=[],h.initialState=[a.util.clone(b.initialState)],h.transitions=[],d=0;d<b.states.length;d++)h.states.push([a.util.clone(b.states[d])]);for(d=0;d<b.acceptingStates.length;d++)h.acceptingStates.push([a.util.clone(b.acceptingStates[d])]);var i=[];for(d=0;d<b.transitions.length;d++)g=a.util.clone(b.transitions[d]),g.fromState=[g.fromState],g.toStates=[g.toStates],g.toStates[0].length>1&&(a.util.containsSet(i,g.toStates[0])||i.push(g.toStates[0])),h.transitions.push(g);for(;0!==i.length;){var j=i.pop();for(h.states.push(j),a.util.containsAny(b.acceptingStates,j)&&h.acceptingStates.push(j),d=0;d<h.alphabet.length;d++){var k=a.fsm.makeTransition(b,j,h.alphabet[d]).sort();for(e=0;e<h.states.length;e++)if(a.util.areEqualSets(k,h.states[e])){k=h.states[e];break}for(e=0;e<i.length;e++)if(a.util.areEqualSets(k,i[e])){k=i[e];break}k.length>0&&h.transitions.push({fromState:j,symbol:h.alphabet[d],toStates:[k]}),!a.util.containsSet(h.states,k)&&!a.util.containsSet(i,k)&&k.length>1&&i.push(k)}}var l=!1,m="ERROR";for(d=0;d<h.states.length;d++)for(e=0;e<h.alphabet.length;e++){var n=!1;for(f=0;f<h.transitions.length;f++)if(g=h.transitions[f],a.util.areEquivalent(g.symbol,h.alphabet[e])&&a.util.areEquivalent(g.fromState,h.states[d])){n=!0;break}n===!1&&(l===!1&&(h.states.push([m]),l=!0),h.transitions.push({fromState:h.states[d],symbol:h.alphabet[e],toStates:[[m]]}))}return h},a.fsm.convertEnfaToNfa=function(b){if(a.fsm.determineType(b)!==a.fsm.enfaType)return b;var c,d,e=a.util.clone(b),f=a.fsm.computeEpsilonClosure(b,[b.initialState]);a.util.containsAny(e.acceptingStates,f)&&!a.util.contains(e.acceptingStates,e.initialState)&&e.acceptingStates.push(e.initialState);var g=[];for(c=0;c<e.states.length;c++)for(d=0;d<e.alphabet.length;d++){var h=a.fsm.makeTransition(e,[e.states[c]],e.alphabet[d]).sort();h.length>0&&g.push({fromState:e.states[c],toStates:h,symbol:e.alphabet[d]})}e.transitions=g;var i=[];for(c=0;c<e.transitions.length;c++){var j=e.transitions[c];if(j.toStates.length>1){var k=!1;for(d=0;d<i.length;d++)if(a.util.areEqualSets(j.toStates,i[d])){j.toStates=i[d],k=!0;break}k===!1&&i.push(j.toStates)}}return e},a.fsm.isLanguageNonEmpty=function(b){var c=a.fsm.determineType(b),d=b;return c===a.fsm.nfaType?d=a.fsm.convertNfaToDfa(b):c===a.fsm.enfaType&&(d=a.fsm.convertEnfaToNfa(b),d=a.fsm.convertNfaToDfa(d)),d=a.fsm.minimize(d),d.acceptingStates.length>0},a.fsm.isLanguageInfinite=function(b){var c=a.fsm.determineType(b),d=b;c===a.fsm.nfaType?d=a.fsm.convertNfaToDfa(b):c===a.fsm.enfaType&&(d=a.fsm.convertEnfaToNfa(b),d=a.fsm.convertNfaToDfa(d)),d=a.fsm.minimize(d);var e,f,g=null;for(e=0;e<d.states.length;e++)if(!a.util.contains(d.acceptingStates,d.states[e])&&(f=a.fsm.getReachableStates(d,d.states[e],!0),!a.util.containsAny(d.acceptingStates,f))){g=d.states[e];break}if(null===g)return!0;for(e=0;e<d.states.length;e++)if(!a.util.areEquivalent(g,d.states[e])&&(f=a.fsm.getReachableStates(d,d.states[e],!1),a.util.contains(f,d.states[e])))return!0;return!1},a.fsm.randomStringInLanguage=function(b){var c=a.fsm.determineType(b),d=b;if(c===a.fsm.nfaType?d=a.fsm.convertNfaToDfa(b):c===a.fsm.enfaType&&(d=a.fsm.convertEnfaToNfa(b),d=a.fsm.convertNfaToDfa(d)),d=a.fsm.minimize(d),0===d.acceptingStates.length)return null;for(var e=d.acceptingStates[Math.floor(Math.random()*d.acceptingStates.length)],f=[];;){if(a.util.areEquivalent(e,d.initialState)===!0&&Math.round(Math.random()))break;var g,h=[];for(g=0;g<d.transitions.length;g++)a.util.areEquivalent(d.transitions[g].toStates[0],e)&&h.push(d.transitions[g]);if(0===h.length)break;var i=h[Math.floor(Math.random()*h.length)];f.push(i.symbol),e=i.fromState}return f.reverse(),f},a.fsm.randomStringNotInLanguage=function(b){var c=a.fsm.determineType(b),d=b;c===a.fsm.nfaType?d=a.fsm.convertNfaToDfa(b):c===a.fsm.enfaType&&(d=a.fsm.convertEnfaToNfa(b),d=a.fsm.convertNfaToDfa(d)),d=a.fsm.minimize(d);var e,f=[];for(e=0;e<d.states.length;e++)a.util.contains(d.acceptingStates,d.states[e])||f.push(d.states[e]);if(0===f.length)return null;for(var g=f[Math.floor(Math.random()*f.length)],h=[];;){if(a.util.areEquivalent(g,d.initialState)===!0&&Math.round(Math.random()))break;var i=[];for(e=0;e<d.transitions.length;e++)a.util.areEquivalent(d.transitions[e].toStates[0],g)&&i.push(d.transitions[e]);if(0===i.length)break;var j=i[Math.floor(Math.random()*i.length)];h.push(j.symbol),g=j.fromState}return h.reverse(),h},a.fsm.union=function(b,c){if(!a.util.areEquivalent(b.alphabet,c.alphabet))throw new Error("Alphabets must be the same");var d,e,f,g={alphabet:a.util.clone(b.alphabet),states:[],initialState:[a.util.clone(b.initialState),a.util.clone(c.initialState)],acceptingStates:[],transitions:[]};for(d=0;d<b.states.length;d++)for(e=0;e<c.states.length;e++){var h=[a.util.clone(b.states[d]),a.util.clone(c.states[e])];for(g.states.push(h),(a.util.contains(b.acceptingStates,b.states[d])||a.util.contains(c.acceptingStates,c.states[e]))&&g.acceptingStates.push(h),f=0;f<g.alphabet.length;f++)g.transitions.push({fromState:h,symbol:g.alphabet[f],toStates:[[a.fsm.makeTransition(b,[b.states[d]],g.alphabet[f])[0],a.fsm.makeTransition(c,[c.states[e]],g.alphabet[f])[0]]]})}return g},a.fsm.intersection=function(b,c){var d,e,f,g=a.util.clone(a.util.setIntersection(b.alphabet,c.alphabet)),h={alphabet:g,states:[],initialState:[a.util.clone(b.initialState),a.util.clone(c.initialState)],acceptingStates:[],transitions:[]};for(d=0;d<b.states.length;d++)for(e=0;e<c.states.length;e++){var i=[a.util.clone(b.states[d]),a.util.clone(c.states[e])];for(h.states.push(i),a.util.contains(b.acceptingStates,b.states[d])&&a.util.contains(c.acceptingStates,c.states[e])&&h.acceptingStates.push(i),f=0;f<h.alphabet.length;f++)h.transitions.push({fromState:i,symbol:h.alphabet[f],toStates:[[a.fsm.makeTransition(b,[b.states[d]],h.alphabet[f])[0],a.fsm.makeTransition(c,[c.states[e]],h.alphabet[f])[0]]]})}return h},a.fsm.difference=function(b,c){if(!a.util.areEquivalent(b.alphabet,c.alphabet))throw new Error("Alphabets must be the same");var d,e,f,g={alphabet:a.util.clone(b.alphabet),states:[],initialState:[a.util.clone(b.initialState),a.util.clone(c.initialState)],acceptingStates:[],transitions:[]};for(d=0;d<b.states.length;d++)for(e=0;e<c.states.length;e++){var h=[a.util.clone(b.states[d]),a.util.clone(c.states[e])];for(g.states.push(h),a.util.contains(b.acceptingStates,b.states[d])&&!a.util.contains(c.acceptingStates,c.states[e])&&g.acceptingStates.push(h),f=0;f<g.alphabet.length;f++)g.transitions.push({fromState:h,symbol:g.alphabet[f],toStates:[[a.fsm.makeTransition(b,[b.states[d]],g.alphabet[f])[0],a.fsm.makeTransition(c,[c.states[e]],g.alphabet[f])[0]]]})}return g},a.fsm.complement=function(b){var c,d=a.util.clone(b),e=[];for(c=0;c<d.states.length;c++)a.util.contains(d.acceptingStates,d.states[c])||e.push(d.states[c]);return d.acceptingStates=e,d},a.fsm.concatenation=function(b,c){if(!a.util.areEquivalent(b.alphabet,c.alphabet))throw new Error("Alphabets must be the same");if(a.util.containsAny(b.states,c.states))throw new Error("States must not overlap");for(var d={alphabet:a.util.clone(b.alphabet),states:a.util.clone(b.states).concat(a.util.clone(c.states)),initialState:a.util.clone(b.initialState),acceptingStates:a.util.clone(c.acceptingStates),transitions:a.util.clone(b.transitions).concat(a.util.clone(c.transitions))},e=0;e<b.acceptingStates.length;e++)d.transitions.push({fromState:a.util.clone(b.acceptingStates[e]),toStates:[a.util.clone(c.initialState)],symbol:a.fsm.epsilonSymbol});return d},a.fsm.kleene=function(b){var c=a.util.clone(b),d="NEW_INITIAL";c.states.push(d),c.transitions.push({fromState:d,toStates:[c.initialState],symbol:a.fsm.epsilonSymbol}),c.initialState=d;for(var e=0;e<c.acceptingStates.length;e++)c.transitions.push({fromState:c.acceptingStates[e],toStates:[d],symbol:a.fsm.epsilonSymbol});return c},a.fsm.reverse=function(b){for(var c=a.util.clone(b),d=[],e=0;e<c.transitions.length;e++)for(var f=0;f<c.transitions[e].toStates.length;f++)d.push({fromState:c.transitions[e].toStates[f],toStates:[c.transitions[e].fromState],symbol:c.transitions[e].symbol});c.transitions=d;var g=c.acceptingStates;c.acceptingStates=[c.initialState];var h="NEW_INITIAL";return c.states.push(h),c.initialState=h,c.transitions.push({fromState:h,toStates:g,symbol:a.fsm.epsilonSymbol}),c},a.fsm.isSubset=function(b,c){var d=a.fsm.intersection(b,c);return a.fsm.areEquivalentFSMs(c,d)},a.fsm.grammar=function(b){var c,d={nonterminals:a.util.clone(b.states),terminals:a.util.clone(b.alphabet),initialNonterminal:a.util.clone(b.initialState),productions:[]};for(c=0;c<b.transitions.length;c++)b.transitions[c].symbol===a.fsm.epsilonSymbol?d.productions.push({left:[a.util.clone(b.transitions[c].fromState)],right:a.util.clone(b.transitions[c].toStates)}):d.productions.push({left:[a.util.clone(b.transitions[c].fromState)],right:[a.util.clone(b.transitions[c].symbol)].concat(a.util.clone(b.transitions[c].toStates))});for(c=0;c<b.acceptingStates.length;c++)d.productions.push({left:[a.util.clone(b.acceptingStates[c])],right:[a.grammar.epsilonSymbol]});return d},a.fsm.symbolsForTransitions=function(b,c,d){for(var e=[],f=0;f<b.transitions.length;f++){var g=b.transitions[f];a.util.areEquivalent(g.fromState,c)&&a.util.contains(g.toStates,d)&&e.push(g.symbol)}return e},a.fsm.toRegex=function(b){var c,d,e,f,g=[],h=b.states.length;for(e=0;h+1>e;e++)for(g[e]=[],c=0;h>c;c++)g[e][c]=[];for(c=0;h>c;c++)for(d=0;h>d;d++){var i=a.fsm.symbolsForTransitions(b,b.states[c],b.states[d]);for(f=0;f<i.length;f++)i[f]=a.re.tree.makeLit(i[f]);c===d&&i.push(a.re.tree.makeEps()),g[0][c][d]=a.re.tree.makeAlt(i)}for(e=1;h+1>e;e++)for(c=0;h>c;c++)for(d=0;h>d;d++){var j="undefined"!=typeof g[e-1][c][e-1].choices&&0===g[e-1][c][e-1].choices.length||"undefined"!=typeof g[e-1][e-1][d].choices&&0===g[e-1][e-1][d].choices.length||"undefined"!=typeof g[e-1][e-1][e-1].choices&&0===g[e-1][e-1][e-1].choices.length,k="undefined"!=typeof g[e-1][c][d].choices&&0===g[e-1][c][d].choices.length,l=null;l=g[e-1][e-1][e-1].tag===a.re.tree.tags.EPS?a.re.tree.makeSeq([g[e-1][c][e-1],g[e-1][e-1][d]]):a.re.tree.makeSeq([g[e-1][c][e-1],a.re.tree.makeKStar(g[e-1][e-1][e-1]),g[e-1][e-1][d]]);var m=[];k||m.push(g[e-1][c][d]),j||m.push(l),m=a.re.tree.makeAlt(m),g[e][c][d]=m}var n=-1,o=[];for(c=0;c<b.states.length;c++)a.util.areEquivalent(b.states[c],b.initialState)&&(n=c),a.util.contains(b.acceptingStates,b.states[c])&&o.push(c);var p=[];for(c=0;c<o.length;c++)p.push(g[h][n][o[c]]);return a.re.tree.makeAlt(p)},a.grammar={},a.grammar.epsilonSymbol="$",a.grammar.regType="regular",a.grammar.cfgType="context-free",a.grammar.csgType="context-sensitive",a.grammar.unrestrictedType="unrestricted",a.grammar.validate=function(b){if(!("undefined"!=typeof b&&Array.isArray(b.nonterminals)&&Array.isArray(b.terminals)&&"undefined"!=typeof b.initialNonterminal&&null!==b.initialNonterminal&&Array.isArray(b.productions)))throw new Error("Grammar must be defined and have nonterminals, terminals, initialNonterminal and productions array properties!");var c,d;if(b.nonterminals.length<1)throw new Error("Set of nonterminals must not be empty.");if(b.terminals.length<1)throw new Error("Set of terminals must not be empty.");for(c=0;c<b.nonterminals.length;c++)if(a.util.contains(b.nonterminals,b.nonterminals[c],c+1))throw new Error("Equivalent nonterminals");for(c=0;c<b.terminals.length;c++)if(a.util.contains(b.terminals,b.terminals[c],c+1))throw new Error("Equivalent terminals");for(c=0;c<b.terminals.length;c++)if(a.util.contains(b.nonterminals,b.terminals[c]))throw new Error("Terminals and nonterminals must not overlap");if(!a.util.contains(b.nonterminals,b.initialNonterminal))throw new Error("InitialNonterminal must be in nonterminals");for(c=0;c<b.productions.length;c++){var e=b.productions[c];if(!Array.isArray(e.left))throw new Error("Left side of production must be an array");if(0===e.left.length)throw new Error("Left side of production must have at least one terminal or nonterminal");for(d=0;d<e.left.length;d++)if(!a.util.contains(b.nonterminals,e.left[d])&&!a.util.contains(b.terminals,e.left[d]))throw new Error("Left side of production must be in nonterminals or terminals");
if(!Array.isArray(e.right))throw new Error("Right side of production must be an array");if(1===e.right.length&&e.right[0]===a.grammar.epsilonSymbol);else{if(0===e.right.length)throw new Error("Right side of production must have at least one terminal or nonterminal or epsilon symbol");for(d=0;d<e.right.length;d++)if(!a.util.contains(b.nonterminals,e.right[d])&&!a.util.contains(b.terminals,e.right[d]))throw new Error("Right side of production must be in nonterminals or terminals")}if(a.util.contains(b.productions,e,c+1))throw new Error("Grammar must not have duplicate productions")}return!0},a.grammar.determineType=function(b){var c,d,e,f=a.grammar.regType,g=null;for(c=0;c<b.productions.length;c++){var h=b.productions[c];if(f===a.grammar.regType)if(1===h.left.length&&a.util.contains(b.nonterminals,h.left[0])){if(1===h.right.length)continue;var i=0;for(e=-1,d=0;d<h.right.length;d++)a.util.contains(b.nonterminals,h.right[d])&&(i+=1,e=d);if(i>1)f=a.grammar.cfgType;else{if(0===i)continue;if(0===e){if(null===g){g=!1;continue}if(g===!1)continue;g===!0&&(f=a.grammar.cfgType)}else if(e===h.right.length-1){if(null===g){g=!0;continue}if(g===!0)continue;g===!1&&(f=a.grammar.cfgType)}else f=a.grammar.cfgType}}else f=a.grammar.cfgType;if(f===a.grammar.cfgType&&(1===h.left.length&&a.util.contains(b.nonterminals,h.left[0])||(f=a.grammar.csgType)),f===a.grammar.csgType){var j=0;for(e=-1,d=0;d<h.left.length;d++)a.util.contains(b.nonterminals,h.left[d])&&(j+=1,e=d);if(j>1)return a.grammar.unrestrictedType;var k=h.left.slice(0,e-1),l=h.left.slice(e);for(d=0;d<k.length;d++)if(!a.util.areEquivalent(k[d],h.right[d]))return a.grammar.unrestrictedType;for(d=0;d<l.length;d++)if(!a.util.areEquivalent(l[l.length-d-1],h.right[h.right.length-d-1]))return a.grammar.unrestrictedType;if(h.right.length<=k.length+l.length)return a.grammar.unrestrictedType}}return f},a.grammar.printAscii=function(b){var c=[];c.push("Initial nonterminal: <"+b.initialNonterminal+">");var d,e,f,g=[];for(d=0;d<b.productions.length;d++){var h=-1;for(e=0;e<g.length;e++)if(a.util.areEquivalent(g[e][0],b.productions[d].left)){h=e;break}-1===h?g[g.length]=[b.productions[d].left,[b.productions[d].right]]:g[h][1].push(b.productions[d].right)}for(d=0;d<g.length;d++){var i=[];for(e=0;e<g[d][0].length;e++)a.util.contains(b.nonterminals,g[d][0][e])?i.push("<"+g[d][0][e].toString()+">"):g[d][0][e]===a.grammar.epsilonSymbol?i.push(g[d][0][e].toString()):i.push('"'+g[d][0][e].toString()+'"');for(i.push("->"),e=0;e<g[d][1].length;e++){for(f=0;f<g[d][1][e].length;f++)a.util.contains(b.nonterminals,g[d][1][e][f])?i.push("<"+g[d][1][e][f].toString()+">"):g[d][1][e][f]===a.grammar.epsilonSymbol?i.push(g[d][1][e][f].toString()):i.push('"'+g[d][1][e][f].toString()+'"');e<g[d][1].length-1&&i.push("|")}c.push(i.join(" "))}return c.join("\n")},a.re=function(){var b=function(){function b(a,b){var c;for(c in a)a.hasOwnProperty(c)&&delete a[c];for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function c(a,c){return a.tag===fa.SEQ&&1===a.elements.length?(a.tag=a.elements[0].tag,b(a,a.elements[0]),!0):!1}function d(a,c){return a.tag===fa.ALT&&1===a.choices.length?(a.tag=a.choices[0].tag,b(a,a.choices[0]),!0):!1}function e(a,b){return a.tag===fa.KSTAR&&a.expr.tag===fa.EPS?(a.tag=a.expr.tag,delete a.expr,!0):!1}function f(a,b){return a.tag===fa.KSTAR&&a.expr.tag===fa.KSTAR?(a.expr=a.expr.expr,!0):!1}function g(a,b){if(a.tag===fa.KSTAR&&a.expr.tag===fa.ALT)for(var c=0;c<a.expr.choices.length;c++)if(a.expr.choices[c].tag===fa.KSTAR)return a.expr.choices[c]=a.expr.choices[c].expr,!0;return!1}function h(a,b){if(a.tag===fa.ALT&&a.choices.length>=2){for(var c=-1,d=-1,e=0;e<a.choices.length;e++)a.choices[e].tag===fa.EPS?c=e:a.choices[e].tag===fa.KSTAR&&(d=e);if(c>=0&&d>=0)return a.choices.splice(c,1),!0}return!1}function i(a,b){if(a.tag===fa.KSTAR&&a.expr.tag===fa.SEQ&&a.expr.elements.length>0){for(var c=!0,d=0;d<a.expr.elements.length;d++)if(a.expr.elements[d].tag!==fa.KSTAR){c=!1;break}if(c)return a.expr.tag=fa.ALT,a.expr.choices=a.expr.elements,delete a.expr.elements,!0}return!1}function j(a,b){if(a.tag===fa.SEQ&&a.elements.length>=2){for(var c=-1,d=0;d<a.elements.length;d++)a.elements[d].tag===fa.EPS&&(c=d);if(c>=0)return a.elements.splice(c,1),!0}return!1}function k(a,b){if(a.tag===fa.ALT&&a.choices.length>=2){var c,d=-1;for(c=0;c<a.choices.length;c++)a.choices[c].tag===fa.ALT&&(d=c);if(d>=0){var e=a.choices[d];for(a.choices.splice(d,1),c=0;c<e.choices.length;c++)a.choices.splice(d+c,0,e.choices[c]);return!0}}return!1}function l(a,b){if(a.tag===fa.SEQ&&a.elements.length>=2){var c,d=-1;for(c=0;c<a.elements.length;c++)if(a.elements[c].tag===fa.SEQ){d=c;break}if(d>=0){var e=a.elements[c];for(a.elements.splice(c,1),c=0;c<e.elements.length;c++)a.elements.splice(d+c,0,e.elements[c]);return!0}}return!1}function m(b,c){if(b.tag===fa.ALT&&b.choices.length>=2)for(var d=0;d<b.choices.length-1;d++){for(var e=-1,f=d+1;f<b.choices.length;f++)if(a.util.areEquivalent(b.choices[d],b.choices[f])){e=f;break}if(e>=0)return b.choices.splice(e,1),!0}return!1}function n(b,c){if(b.tag===fa.ALT&&b.choices.length>=2)for(var d=0;d<b.choices.length-1;d++){for(var e=-1,f=d+1;f<b.choices.length;f++){if(b.choices[f].tag===fa.KSTAR&&a.util.areEquivalent(b.choices[f].expr,b.choices[d])){e=d;break}if(b.choices[d].tag===fa.KSTAR&&a.util.areEquivalent(b.choices[d].expr,b.choices[f])){e=f;break}}if(e>=0)return b.choices.splice(e,1),!0}return!1}function o(b,c){if(b.tag===fa.SEQ&&b.elements.length>=2){for(var d=-1,e=0;e<b.elements.length-1;e++)if(b.elements[e].tag===fa.KSTAR&&b.elements[e+1].tag===fa.KSTAR&&a.util.areEquivalent(b.elements[e],b.elements[e+1])){d=e;break}if(d>=0)return b.elements.splice(d+1,1),!0}return!1}function p(b,c){if(b.tag===fa.KSTAR&&b.expr.tag===fa.ALT&&b.expr.choices.length>=2)for(var d=0;d<b.expr.choices.length;d++)for(var e=0;e<b.expr.choices.length;e++)if(d!==e&&b.expr.choices[e].tag===fa.SEQ&&b.expr.choices[e].elements.length>=2){for(var f=!0,g=0;g<b.expr.choices[e].elements.length;g++)if(!a.util.areEquivalent(b.expr.choices[d],b.expr.choices[e].elements[g])){f=!1;break}if(f)return b.expr.choices.splice(e,1),!0}return!1}function q(a,b){if(a.tag===fa.KSTAR&&a.expr.tag===fa.ALT&&a.expr.choices.length>=2)for(var c=0;c<a.expr.choices.length;c++)if(a.expr.choices[c].tag===fa.EPS)return a.expr.choices.splice(c,1),!0;return!1}function r(b,c){if(b.tag===fa.ALT&&b.choices.length>=2)for(var d=0;d<b.choices.length-1;d++)if(b.choices[d].tag===fa.SEQ&&b.choices[d].elements.length>=2)for(var e=d+1;e<b.choices.length;e++)if(b.choices[e].tag===fa.SEQ&&b.choices[e].elements.length>=2&&a.util.areEquivalent(b.choices[e].elements[0],b.choices[d].elements[0])){var f=b.choices[d].elements[0],g=I(b.choices[d].elements.slice(1)),h=I(b.choices[e].elements.slice(1)),i=H([g,h]),j=I([f,i]);return b.choices[d]=j,b.choices.splice(e,1),!0}return!1}function s(b,c){if(b.tag===fa.SEQ&&b.elements.length>=3)for(var d=1;d<b.elements.length-1;d++)if(b.elements[d-1].tag===fa.KSTAR&&b.elements[d+1].tag===fa.KSTAR&&a.util.areEquivalent(b.elements[d-1],b.elements[d+1])&&a.util.areEquivalent(b.elements[d-1].expr,b.elements[d]))return b.elements.splice(d-1,1),!0;return!1}function t(b,c){if(b.tag===fa.ALT&&b.choices.length>=2)for(var d=0;d<b.choices.length-1;d++)if(b.choices[d].tag===fa.SEQ&&b.choices[d].elements.length>=2)for(var e=d+1;e<b.choices.length;e++)if(b.choices[e].tag===fa.SEQ&&b.choices[e].elements.length>=2&&a.util.areEquivalent(b.choices[e].elements[b.choices[e].elements.length-1],b.choices[d].elements[b.choices[d].elements.length-1])){var f=b.choices[d].elements[b.choices[d].elements.length-1],g=I(b.choices[d].elements.slice(0,b.choices[d].elements.length-1)),h=I(b.choices[e].elements.slice(0,b.choices[e].elements.length-1)),i=H([g,h]),j=I([i,f]);return b.choices[d]=j,b.choices.splice(e,1),!0}return!1}function u(b,c){if(b.tag===fa.ALT&&b.choices.length>=2){var d=[];d.push(w(b.choices[0],c));for(var e=-1,f=0;f<b.choices.length-1;f++)for(var g=f+1;g<b.choices.length;g++){d.length<=g&&d.push(w(b.choices[g],c));try{a.fsm.isSubset(d[f],d[g])&&(e=g)}catch(h){}try{a.fsm.isSubset(d[g],d[f])&&(e=f)}catch(h){}if(e>=0)return b.choices.splice(e,1),!0}}return!1}function v(b,c){if(b.tag===fa.KSTAR&&b.expr.tag===fa.ALT&&b.expr.choices.length>=2){var d=[];d.push(w(J(b.expr.choices[0]),c));for(var e=-1,f=0;f<b.expr.choices.length-1;f++)for(var g=f+1;g<b.expr.choices.length;g++){d.length<=g&&d.push(w(J(b.expr.choices[g]),c));try{a.fsm.isSubset(d[f],d[g])&&(e=g)}catch(h){}try{a.fsm.isSubset(d[g],d[f])&&(e=f)}catch(h){}if(e>=0)return b.expr.choices.splice(e,1),!0}}return!1}function w(b,c){var d=c.get(b);return d||(d=a.fsm.minimize(a.re.tree.toAutomaton(b)),c.put(b,d)),d}function x(b,c){if(b.tag===fa.SEQ&&b.elements.length>=2){var d=[];d.push(w(b.elements[0],c));for(var e=-1,f=0;f<b.elements.length-1;f++)if(d.push(w(b.elements[f+1],c)),b.elements[f].tag===fa.KSTAR&&b.elements[f+1].tag===fa.KSTAR){try{a.fsm.isSubset(d[f],d[f+1])&&(e=f+1)}catch(g){}try{a.fsm.isSubset(d[f+1],d[f])&&(e=f)}catch(g){}if(e>=0)return b.elements.splice(e,1),!0}}return!1}function y(b,c){if(b.tag===fa.ALT&&b.choices.length>1){var d=a.util.index(b.choices,L());if(d>=0)for(var e=0;e<b.choices.length;e++)if(b.choices[e].tag!==fa.EPS){var f=w(b.choices[e],c);if(a.fsm.isAcceptingState(f,f.initialState))return b.choices.splice(d,1),!0}}return!1}function z(b,c){if(b.tag===fa.SEQ&&b.elements.length>1)for(var d=0;d<b.elements.length-1;d++)if(b.elements[d].tag===fa.KSTAR&&b.elements[d+1].tag===fa.ALT&&2===b.elements[d+1].choices.length){var e=a.util.index(b.elements[d+1].choices,L());if(e>=0){var f=0===e?b.elements[d+1].choices[1]:b.elements[d+1].choices[0];if(f.tag===fa.SEQ&&2===f.elements.length&&f.elements[1].tag===fa.KSTAR&&f.elements[1].expr.tag===fa.ALT&&2===f.elements[1].expr.choices.length&&a.util.contains(f.elements[1].expr.choices,b.elements[d].expr)&&a.util.contains(f.elements[1].expr.choices,f.elements[0]))return b.elements[d+1]=f.elements[1],b.elements.splice(d,1),!0}}return!1}function A(b,c){if(b.tag===fa.SEQ&&b.elements.length>1)for(var d=1;d<b.elements.length;d++)if(b.elements[d].tag===fa.KSTAR&&b.elements[d-1].tag===fa.ALT&&2===b.elements[d-1].choices.length){var e=a.util.index(b.elements[d-1].choices,L());if(e>=0){var f=0===e?b.elements[d-1].choices[1]:b.elements[d-1].choices[0];if(f.tag===fa.SEQ&&2===f.elements.length&&f.elements[0].tag===fa.KSTAR&&f.elements[0].expr.tag===fa.ALT&&2===f.elements[0].expr.choices.length&&a.util.contains(f.elements[0].expr.choices,b.elements[d].expr)&&a.util.contains(f.elements[0].expr.choices,f.elements[1]))return b.elements[d-1]=f.elements[0],b.elements.splice(d,1),!0}}return!1}function B(b,c){if(b.tag===fa.SEQ&&b.elements.length>1)for(var d=0;d<b.elements.length;d++)if(b.elements[d].tag===fa.KSTAR)if(d>0&&b.elements[d-1].tag===fa.ALT&&b.elements[d-1].choices.length>1){var e=a.util.index(b.elements[d-1].choices,L());if(e>=0){var f=b.elements[d-1].choices.splice(e,1)[0],g=w(b.elements[d],c),h=w(b.elements[d-1],c),i=!1;try{a.fsm.isSubset(g,h)&&(i=!0)}catch(j){}if(i)return b.elements.splice(d-1,1),!0;b.elements[d-1].choices.splice(e,0,f)}}else if(d<b.elements.length-1&&b.elements[d+1].tag===fa.ALT&&b.elements[d+1].choices.length>1){var e=a.util.index(b.elements[d+1].choices,L());if(e>=0){var f=b.elements[d+1].choices.splice(e,1)[0],g=w(b.elements[d],c),h=w(b.elements[d+1],c),i=!1;try{a.fsm.isSubset(g,h)&&(i=!0)}catch(j){}if(i)return b.elements.splice(d+1,1),!0;b.elements[d+1].choices.splice(e,0,f)}}}function C(a,b){if(a.tag===fa.SEQ&&a.elements.length>=1)for(var c=0;c<a.elements.length;c++)if(a.elements[c].tag===fa.SEQ&&0===a.elements[c].elements.length||a.elements[c].tag===fa.ALT&&0===a.elements[c].choices.length)return a.elements=[],!0;return!1}function D(a,b){return a.tag===fa.KSTAR&&a.expr.tag===fa.SEQ&&0===a.expr.elements.length?(a.tag=fa.SEQ,delete a.expr,a.elements=[],!0):!1}function E(b,c){var d=a.util.clone(b);"undefined"==typeof c&&(c={});var e=a.util.clone(c);"undefined"==typeof e.numIterations&&(e.numIterations=null),"undefined"==typeof e.appliedPatterns?e.appliedPatterns=null:e.appliedPatterns=c.appliedPatterns,"undefined"==typeof e.useFsmPatterns&&(e.useFsmPatterns=!0);for(var f="temp",g=0,h=new a.util.HashTable;null!==f&&(null===e.numIterations||g<e.numIterations);)f=F(d,h,e.useFsmPatterns),null!==f&&null!==e.appliedPatterns&&e.appliedPatterns.push(f),g+=1;return d}function F(a,b,c){for(var d=null,e=null,f=0;f<ga.length;f++)if(d=ga[f],(c!==!1||"fsm"!==d.type)&&(e=G(a,d["function"],b)))return d.pattern;return null}function G(a,b,c){var d=b(a,c);if(d)return d;var e=[];a.tag===fa.ALT?e=a.choices:a.tag===fa.SEQ?e=a.elements:a.tag===fa.KSTAR&&(e=[a.expr]);for(var f=0;f<e.length;f++)if(d=G(e[f],b,c))return d;return!1}function H(a){return{tag:fa.ALT,choices:a}}function I(a){return{tag:fa.SEQ,elements:a}}function J(a){return{tag:fa.KSTAR,expr:a}}function K(a){return{tag:fa.LIT,obj:a}}function L(){return ha}function M(b,c,d){for(var e=a.fsm.addState(c,d.getAndAdvance()),f=a.fsm.addState(c,d.getAndAdvance()),g=0;g<b.choices.length;g++){var h=R(b.choices[g],c,d);a.fsm.addEpsilonTransition(c,e,[h[0]]),a.fsm.addEpsilonTransition(c,h[1],[f])}return[e,f]}function N(b,c,d){for(var e,f,g,h=0;h<b.elements.length;h++)g=R(b.elements[h],c,d),0===h?e=g[0]:a.fsm.addEpsilonTransition(c,f,[g[0]]),f=g[1];return void 0===e&&(e=a.fsm.addState(c,d.getAndAdvance()),f=a.fsm.addState(c,d.getAndAdvance())),[e,f]}function O(b,c,d){var e=a.fsm.addState(c,d.getAndAdvance()),f=a.fsm.addState(c,d.getAndAdvance()),g=R(b.expr,c,d),h=g[0],i=g[1];return a.fsm.addEpsilonTransition(c,e,[f]),a.fsm.addEpsilonTransition(c,e,[h]),a.fsm.addEpsilonTransition(c,i,[h]),a.fsm.addEpsilonTransition(c,i,[f]),[e,f]}function P(b,c,d){var e=a.fsm.addState(c,d.getAndAdvance()),f=a.fsm.addState(c,d.getAndAdvance());try{a.fsm.addSymbol(c,b.obj)}catch(g){}return a.fsm.addTransition(c,e,[f],b.obj),[e,f]}function Q(b,c,d){var e=a.fsm.addState(c,d.getAndAdvance()),f=a.fsm.addState(c,d.getAndAdvance());return a.fsm.addEpsilonTransition(c,e,[f]),[e,f]}function R(a,b,c){return ia[a.tag](a,b,c)}function S(b){var c=a.fsm.makeNew(),d=R(b,c,a.util.makeCounter(0));return a.fsm.setInitialState(c,d[0]),a.fsm.addAcceptingState(c,d[1]),c}function T(a,b){return ja[a.tag]>=ja[b.tag]}function U(b,c,d){var e=T(b,c);e&&d.push(a.re.array.specials.LEFT_PAREN),_(c,d),e&&d.push(a.re.array.specials.RIGHT_PAREN)}function V(a,b,c,d){for(var e=0;e<c.length;e++)void 0!==d&&e>0&&b.push(d),U(a,c[e],b)}function W(b,c){V(b,c,b.choices,a.re.array.specials.ALT)}function X(a,b){V(a,b,a.elements)}function Y(b,c){U(b,b.expr,c),c.push(a.re.array.specials.KSTAR)}function Z(a,b){b.push(a.obj)}function $(b,c){c.push(a.re.array.specials.EPS)}function _(a,b){return ka[a.tag](a,b)}function aa(a){var b=[];return _(a,b),b}function ba(b){return a.re.array.toString(aa(b))}function ca(a,b,c){var d=.5,e=.1,f=.1;return c&&(c.ALT_PROB&&(d=c.ALT_PROB),c.KLEENE_PROB&&(e=c.KLEENE_PROB),c.EPS_PROB&&(f=c.EPS_PROB)),da(a,b,d,e,f)}function da(a,b,c,d,e){var f=ea(a,b,c,d,e);return Math.random()<=d&&(f=J(f)),f}function ea(b,c,d,e,f){if(0===b)return L();if(1==b)return K(c[a.util.randint(0,c.length-1)]);if(Math.random()<=f)return H([L(),da(b,c,d,e,f)]);var g=a.util.randint(1,b-1),h=da(g,c,d,e,f),i=da(b-g,c,d,e,f);return Math.random()<=d?H([h,i]):I([h,i])}var fa={ALT:"alt",SEQ:"sequence",KSTAR:"kleene_star",LIT:"literal",EPS:"epsilon"},ga=[];ga.push({pattern:"(a()) => ()",type:"structure","function":C}),ga.push({pattern:"()* => ()",type:"structure","function":D}),ga.push({pattern:"(a) => a",type:"structure","function":c}),ga.push({pattern:"(a) => a",type:"structure","function":d}),ga.push({pattern:"$* => $",type:"structure","function":e}),ga.push({pattern:"(a*)* => a*",type:"structure","function":f}),ga.push({pattern:"(a+b*)* => (a+b)*",type:"structure","function":g}),ga.push({pattern:"$+a* => a*",type:"structure","function":h}),ga.push({pattern:"(a*b*)* => (a*+b*)*",type:"structure","function":i}),ga.push({pattern:"$a => a",type:"structure","function":j}),ga.push({pattern:"a+a => a",type:"structure","function":m}),ga.push({pattern:"a+a* => a*",type:"structure","function":n}),ga.push({pattern:"a*a* => a*",type:"structure","function":o}),ga.push({pattern:"(aa+a)* => (a)*",type:"structure","function":p}),ga.push({pattern:"(a + $)* => (a)*",type:"structure","function":q}),ga.push({pattern:"(ab+ac) => a(b+c)",type:"structure","function":r}),ga.push({pattern:"a*aa* => aa*",type:"structure","function":s}),ga.push({pattern:"(ab+cb) => (a+c)b",type:"structure","function":t}),ga.push({pattern:"a*($+b(a+b)*) => (a+b)*",type:"structure","function":z}),ga.push({pattern:"($+(a+b)*a)b* => (a+b)*",type:"structure","function":A}),ga.push({pattern:"$+L => L, if L contains $",type:"fsm","function":y}),ga.push({pattern:"L1+L2 => L2, if L1 is subset of L2",type:"fsm","function":u}),ga.push({pattern:"(L1+L2)* => L2, if L1* is subset of L2*",type:"fsm","function":v}),ga.push({pattern:"L1*L2* => L2, if L1* is subset of L2*",type:"fsm","function":x}),ga.push({pattern:"(L1+$)(L2)* => (L2)* if L1 is subset of L2",type:"fsm","function":B}),ga.push({pattern:"ab(cd) => abcd",type:"structure","function":l}),ga.push({pattern:"(a+(b+c)) => a+b+c",type:"structure","function":k});var ha={tag:fa.EPS},ia={};ia[fa.ALT]=M,ia[fa.SEQ]=N,ia[fa.KSTAR]=O,ia[fa.LIT]=P,ia[fa.EPS]=Q;var ja={};ja[fa.ALT]=0,ja[fa.SEQ]=1,ja[fa.KSTAR]=2,ja[fa.LIT]=3,ja[fa.EPS]=3;var ka={};return ka[fa.ALT]=W,ka[fa.SEQ]=X,ka[fa.KSTAR]=Y,ka[fa.LIT]=Z,ka[fa.EPS]=$,{tags:fa,makeAlt:H,makeSeq:I,makeKStar:J,makeLit:K,makeEps:L,toAutomaton:S,toArray:aa,toString:ba,random:ca,simplify:E}}(),c=function(){function b(a,b){this.name="RegexError",this.message=a,this.position=b}function c(){return this.arr[this.idx]}function d(){++this.idx}function e(a){return{arr:a,idx:0,peek:c,advance:d}}function f(c){if(0===c.length)return a.re.tree.makeSeq([]);var d=e(c),f=k(d);if(void 0!==d.peek())throw new b("Malformed regex array: successfully parsed up to position "+d.idx,d.idx);return f}function g(a){return a===q.ALT||a===q.KSTAR||a===q.LEFT_PAREN||a===q.RIGHT_PAREN||a===q.EPS?a.toString():void 0}function h(b){for(var c=a.re.string.escapable,d=0;d<c.length;d++)if(b===c[d])return"\\"+b;return b}function i(a){for(var c,d=[],e=!1,f=0;f<a.length;f++){if(c=a[f],"string"==typeof c?1!==c.length?e=!0:c=h(c):(c=g(c),void 0===c&&(e=!0)),e)throw new b("Array regex not convertible to string representation: failed at position "+f,f);d.push(c)}return d.join("")}function j(b){var c=a.re.array.toTree(b);return a.re.tree.toAutomaton(c)}function k(b){for(var c=[];;){if(c.push(l(b)),b.peek()!==q.ALT)break;b.advance()}return a.re.tree.makeAlt(c)}function l(c){for(var d,e=[];;){if(d=m(c),void 0===d)break;e.push(d)}if(0===e.length)throw new b("Malformed regex array: empty choice subexpression at index "+c.idx,c.idx);return a.re.tree.makeSeq(e)}function m(b){var c=n(b);return b.peek()===q.KSTAR&&(b.advance(),c=a.re.tree.makeKStar(c)),c}function n(c){if(c.peek()===q.LEFT_PAREN){c.advance();var d=k(c);if(c.peek()!==q.RIGHT_PAREN)throw new b("Malformed regex array: missing matching right parenthesis at index "+c.idx,c.idx);return c.advance(),d}if(c.peek()===q.EPS)return c.advance(),a.re.tree.makeEps();if(void 0===c.peek()||c.peek()===q.ALT||c.peek()===q.RIGHT_PAREN)return void 0;if(c.peek()===q.KSTAR)throw new b("Malformed regex array: empty subexpression before Kleene star at index "+c.idx,c.idx);var e=a.re.tree.makeLit(c.peek());return c.advance(),e}function o(b,c,d){return a.re.tree.toArray(a.re.tree.random(b,c,d))}function p(b,c,d){var e=a.re.array.toTree(b),f=a.re.tree.simplify(e,c,d);return a.re.tree.toArray(f)}var q={ALT:{},KSTAR:{},LEFT_PAREN:{},RIGHT_PAREN:{},EPS:{}};return q.ALT.toString=function(){return"+"},q.KSTAR.toString=function(){return"*"},q.LEFT_PAREN.toString=function(){return"("},q.RIGHT_PAREN.toString=function(){return")"},q.EPS.toString=function(){return"$"},b.prototype=new Error,{specials:q,toTree:f,toString:i,toAutomaton:j,random:o,simplify:p}}(),d=function(){function b(b){for(var c,d=[],e=!1,f=a.re.array.specials,h=0;h<b.length;++h)if(e){if(-1===g.indexOf(b[h]))throw new RegexError("Malformed string regex: illegal escape sequence \\"+b[h],h);d.push(b[h]),e=!1}else if("\\"===b[h])e=!0;else{switch(c=b[h]){case"$":c=f.EPS;break;case"+":c=f.ALT;break;case"*":c=f.KSTAR;break;case"(":c=f.LEFT_PAREN;break;case")":c=f.RIGHT_PAREN}d.push(c)}if(e)throw new RegexError("Malformed string regex: unfinished escape sequence at end of string",b.length-1);return d}function c(b){var c=a.re.string.toArray(b);return a.re.array.toTree(c)}function d(b){var c=a.re.string.toTree(b);return a.re.tree.toAutomaton(c)}function e(b,c,d){for(var e=[],f=0;f<c.length;f++)e.push(c.charAt(f));return a.re.tree.toString(a.re.tree.random(b,e,d))}function f(b,c,d){var e=a.re.string.toTree(b),f=a.re.tree.simplify(e,c,d);return a.re.tree.toString(f)}var g="$+*()\\";return{escapable:g,toArray:b,toTree:c,toAutomaton:d,random:e,simplify:f}}();return{tree:b,array:c,string:d}}(),a}());